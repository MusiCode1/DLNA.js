# אודות פרויקט הלחצן החכם

## הרקע והמטרה

הפרויקט נולד מתוך רצון לאפשר למוישי, בחור יקר עם צרכים מיוחדים, חוויה עצמאית ומהנה יותר. שמתי לב שהוא נהנה לצפות בתכנים מסוימים במסך הטלוויזיה, אך לא תמיד הייתה לו האפשרות להפעיל אותו בעצמו. מכאן נולד הרעיון: מה אם נוכל לתת לו את הכוח להפעיל את המסך ולבחור תוכן לצפייה, באופן עצמאי לחלוטין, באמצעות לחיצת כפתור פשוטה?

השאלה המרכזית הייתה האם הוא יקשר בין הלחיצה על הכפתור לבין הפעלת הסרטון. הדרך היחידה לגלות הייתה לנסות.

## החיפוש אחר פתרון טכנולוגי

המסכים בדירה הם מתוצרת פוג'יקום, המריצים מערכת הפעלה **WebOS** של LG. המסע הטכנולוגי למציאת פתרון התחלק לכמה שלבים.

### גישה ראשונה: WebOS API

הכיוון הראשוני היה לחקור את ה-API של WebOS, מתוך הנחה שאם אפליקציות בטלפון הנייד יכולות לשלוט במסך, אוכל לעשות זאת גם באמצעות קוד. מצאתי מספר ספריות קוד המממשות את הפרוטוקול, אך נתקלתי במגבלה משמעותית: לא הייתה דרך פשוטה להפעיל קובץ וידאו ספציפי. הפתרון היחיד היה לחקות פעולות של שלט רחוק (למעלה, למטה, ימינה, שמאלה), גישה שברירית מאוד ורגישה לכל שינוי בממשק או במערכת הקבצים. לכן, כיוון זה נזנח.

### גישה שנייה: שילוב WakeOnLan ו-DLNA

הפתרון החלופי שנבחר מורכב משני פרוטוקולים סטנדרטיים:

1.  **WakeOnLan (WOL):** פרוטוקול ותיק המאפשר "להעיר" מכשירים ברשת על ידי שליחת "חבילת קסם" (Magic Packet) לכתובת ה-MAC של המכשיר. בדיקה מהירה אישרה שהטלוויזיות אכן תומכות בפרוטוקול ונדלקות בהצלחה.

2.  **DLNA (Digital Living Network Alliance):** פרוטוקול ותיק נוסף לתקשורת בין מכשירי מדיה. הפרוטוקול מגדיר מספר סוגי מכשירים, שניים מהם רלוונטיים לפרויקט שלנו:
    *   **שרת מדיה (Digital Media Server - DMS):** רכיב המאפשר למכשירים אחרים ברשת לעיין בקבצי המדיה המאוחסנים בו ולהזרים אותם.
    *   **מציג מדיה (Digital Media Renderer - DMR):** רכיב המסוגל לנגן מדיה משרת מדיה. ניתן לשלוט בו מרחוק באמצעות פקודות DLNA. מסכי ה-WebOS תומכים במצב זה.

## ארכיטקטורת הפתרון

הפתרון הסופי מבוסס על הארכיטקטורה הבאה:

*   **שרת מדיה DLNA:** על מחשב בדירה רץ שרת DLNA המשתף תיקייה מסונכרנת עם Google Drive. כך, ניתן לעדכן את רשימת הסרטונים הזמינים בקלות מכל מקום.
*   **לחצן הפעלה:** על המסך מותקן לחצן פיזי המבוסס על בקר ESP32. לחיצה על הכפתור שולחת בקשת `Webhook` לשרת הניהול.
*   **שרת ניהול:** שרת קל משקל, הרץ על אותו מחשב, מאזין לבקשות מהלחצן ומתזמר את כל הפעולות הנדרשות.

### רצף הפעולות בלחיצת כפתור

1.  **הפעלת המסך:** שרת הניהול שולח פקודת `WakeOnLan` לטלוויזיה.
2.  **המתנה:** השרת ממתין מספר שניות עד שהטלוויזיה עולה ומערכת ההפעלה שלה מוכנה לקבל פקודות.
3.  **טעינת רשימת השמעה:** השרת שולח סדרת פקודות `DLNA` לטלוויזיה (לרכיב ה-`MediaRenderer`):
    *   פקודת `SetAVTransportURI` נשלחת כדי לטעון את הסרטון הראשון.
    *   פקודות `SetNextAVTransportURI` נשלחות בשרשרת כדי להגדיר את הסרטונים הבאים בתור.
4.  **ניגון:** פקודת `Play` נשלחת כדי להתחיל את ניגון הסרטון הנוכחי.

## אתגרים ויישום

במהלך הפיתוח, התברר כי אין ספריית JavaScript קיימת המממשת את כל פקודות ה-DLNA הנדרשות לפרויקט. לכן, נכתבה ספרייה ייעודית מאפס. הספרייה פותחה באופן מודולרי ונשמרת בנפרד מקוד שרת הניהול, כך שניתן יהיה לעשות בה שימוש חוזר בפרויקטים עתידיים.

## סיכום

הפרויקט מהווה דוגמה מרגשת לאופן שבו ניתן לרתום טכנולוגיה כדי לשפר את איכות חייהם של אנשים. על אף שמוישי עדיין לומד את הקשר בין הלחיצה לתוצאה, הוא כבר משתמש בלחצן, וזוהי ההצלחה הגדולה ביותר של הפרויקט.
