# תוכנית להעברת ממשק המשתמש ל-Svelte

מסמך זה מפרט את התוכנית להעברת ממשק המשתמש הקיים, המבוסס על HTML ו-JavaScript ונילה, לאפליקציית עמוד יחיד (SPA) מודרנית באמצעות SvelteKit.

## 1. ניתוח המערכת הקיימת

המערכת הקיימת מורכבת משלושה חלקים עיקריים:
- **דף רשימת מכשירים (`index.html`, `index.js`)**: מציג רשימה של מכשירי UPnP שהתגלו ברשת ומתרענן אוטומטית.
- **דף דפדפן תוכן (`browser.html`, `browser.js`)**: מאפשר ניווט היררכי בתוכן של שרת מדיה, וכן הפעלת קבצים על נגנים אחרים (Renderers).
- **דף שליטת נגן (`renderer_control.html`, `renderer_control.js`)**: ממשק לשליטה בניגון מדיה על נגן.

התקשורת עם השרת מתבצעת דרך API פנימי בנתיב `/api/`.

## 2. מטרות הפרויקט

- **מודרניזציה של הממשק**: שימוש בטכנולוגיות מודרניות (SvelteKit) לשיפור חווית המשתמש והמפתח.
- **יצירת Single Page Application (SPA)**: איחוד כל הפונקציונליות לאפליקציה אחת, מה שיאפשר מעברים חלקים יותר בין המסכים וניהול מצב (state) יעיל יותר.
- **שיפור מבנה הקוד**: ארגון הקוד בקומפוננטות רב-פעמיות וקלות לתחזוקה.
- **שיפור חווית המשתמש (UX)**: עיצוב ממשק אינטואיטיבי ומגיב יותר.

## 3. בחירת טכנולוגיות

- **פריימוורק**: SvelteKit
- **שפה**: TypeScript
- **עיצוב**: Tailwind CSS (מומלץ, ניתן להחליט בהמשך)

## 4. מבנה האפליקציה החדשה (מבוסס SvelteKit)

### 4.1. ניתוב (Routing)

- `/`: דף הבית, יציג את רשימת המכשירים (מחליף את `index.html`).
- `/browse/{udn}`: דף דפדפן התוכן עבור מכשיר ספציפי. ה-`udn` יועבר כפרמטר בנתיב.
- `/remote/{udn}`: דף השליטה בנגן.

### 4.2. מבנה תיקיות וקומפוננטות

```
src/
├── lib/
│   ├── api/
│   │   └── index.ts       # פונקציות לתקשורת עם ה-API
│   ├── components/
│   │   ├── DeviceList.svelte
│   │   ├── DeviceListItem.svelte
│   │   ├── FileBrowser.svelte
│   │   ├── Breadcrumbs.svelte
│   │   ├── MediaItem.svelte
│   │   ├── RemoteControl.svelte
│   │   └── Modal.svelte
│   └── stores/
│       └── devices.ts     # Svelte store לניהול רשימת המכשירים
└── routes/
    ├── +page.svelte       # דף הבית (רשימת מכשירים)
    ├── browse/
    │   └── [udn]/
    │       └── +page.svelte # דף דפדפן התוכן
    └── remote/
        └── [udn]/
            └── +page.svelte # דף השליטה בנגן
```

## 5. שלבי ביצוע

### שלב 1: הגדרת פרויקט SvelteKit חדש
- יצירת package חדש בנתיב `DLNA/packages/svelte-gui`.
- בתוך התיקייה החדשה, יצירת פרויקט SvelteKit חדש באמצעות `npm create svelte@latest`.
- התקנת תלויות נדרשות (למשל, Tailwind CSS).
- הגדרת TypeScript ו-ESLint.

### שלב 2: ניתוח והגדרת מבנה האפליקציה החדשה
- שלב זה הושלם במסגרת תכנון זה.

### שלב 3: יצירת קומפוננטות Svelte בסיסיות
- יצירת קבצי Svelte ריקים עבור כל קומפוננטה שזוהתה במבנה התיקיות.
- בניית ה-HTML וה-CSS הבסיסיים של כל קומפוננטה, ללא לוגיקה.

### שלב 4: מימוש לוגיקת התקשורת עם ה-API
- יצירת מודול `src/lib/api/index.ts`.
- מימוש פונקציות אסינכרוניות שיעטפו את קריאות ה-`fetch` לכל נקודות הקצה של ה-API.
- הגדרת טיפוסים (types) עבור הנתונים המוחזרים מה-API.

### שלב 5: בניית דף רשימת המכשירים
- שימוש ב-Svelte store (`src/lib/stores/devices.ts`) כדי לאחזר ולנהל את רשימת המכשירים.
- ה-store יבצע polling ל-API ברקע.
- הקומפוננטה `DeviceList.svelte` תירשם ל-store ותציג את המכשירים באמצעות `DeviceListItem.svelte`.

### שלב 6: בניית דף דפדפן התוכן
- הדף `routes/browse/[udn]/+page.svelte` יקבל את ה-`udn` מה-URL.
- הוא ישתמש בקומפוננטה `FileBrowser.svelte` שתנהל את הלוגיקה של:
  - אחזור תוכן מה-API.
  - ניהול מצב הניווט (פירורי לחם).
  - הצגת הפריטים באמצעות `MediaItem.svelte`.
  - פתיחת מודאל לבחירת נגן.

### שלב 7: בניית קומפוננטת שלט הנגן
- הקומפוננטה `RemoteControl.svelte` תמוקם בדף `routes/remote/[udn]/+page.svelte`.
- היא תנהל את הלוגיקה של:
  - שליחת פקודות לנגן דרך ה-API.
  - Polling למצב הנגן ועדכון הממשק בהתאם.

### שלב 8: שילוב וחיבור בין כל החלקים
- וידוא שהניווט בין הדפים עובד כצפוי.
- חיבור הלוגיקה של "Play To..." מדף הדפדפן לניווט לדף השלט.
- ליטוש העיצוב וחווית המשתמש.

### שלב 9: תיעוד התכנון וההחלטות
- שלב זה הושלם במסגרת מסמך זה.

## 6. דיאגרמת זרימה (Mermaid)

```mermaid
graph TD
    A[התחלה: כניסה לאפליקציה] --> B{/};
    B --> C[דף רשימת מכשירים];
    C -- לחיצה על מכשיר --> D{/browse/:udn};
    D --> E[דף דפדפן תוכן];
    E -- לחיצה על 'שליטה' --> F{/remote/:udn};
    F --> G[דף שלט רחוק];
    E -- לחיצה על 'Play To...' --> H[מודאל בחירת נגן];
    H -- בחירת נגן ואישור --> I[שליחת בקשת ניגון ל-API];
    I -- הצלחה --> G;